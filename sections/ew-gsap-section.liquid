{% schema %}
{
  "name": "GSAP Image Slider",
  "settings": [
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Section Background Color",
      "default": "#ffffff"
    },

    { "type": "image_picker", "id": "slide_1_img", "label": "Slide 1 Image" },
    { "type": "text", "id": "slide_1_text", "label": "Slide 1 Title", "default": "Slide 1" },

    { "type": "image_picker", "id": "slide_2_img", "label": "Slide 2 Image" },
    { "type": "text", "id": "slide_2_text", "label": "Slide 2 Title", "default": "Slide 2" },

    { "type": "image_picker", "id": "slide_3_img", "label": "Slide 3 Image" },
    { "type": "text", "id": "slide_3_text", "label": "Slide 3 Title", "default": "Slide 3" },

    { "type": "image_picker", "id": "slide_4_img", "label": "Slide 4 Image" },
    { "type": "text", "id": "slide_4_text", "label": "Slide 4 Title", "default": "Slide 4" },

    { "type": "image_picker", "id": "slide_5_img", "label": "Slide 5 Image" },
    { "type": "text", "id": "slide_5_text", "label": "Slide 5 Title", "default": "Slide 5" },

    { "type": "image_picker", "id": "slide_6_img", "label": "Slide 6 Image" },
    { "type": "text", "id": "slide_6_text", "label": "Slide 6 Title", "default": "Slide 6" }
  ],
  "presets": [
    {
      "name": "GSAP Image Slider"
    }
  ]
}
{% endschema %}

<style>
  .ew-gsap-section {
    background-color: {{ section.settings.section_bg_color }};
  }

  .ew-gsap-section * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .ew-gsap-section .wrapper {
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ew-gsap-section .slider {
    width: 300px;
    height: 300px;
    position: relative;
    perspective: 500px;
  }

  @media (min-width: 768px) {
    .ew-gsap-section .slider {
      width: 420px;
      height: 420px;
    }
  }

.ew-gsap-section .slide {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  backface-visibility: hidden;
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ew-gsap-section .slide-content {
  position: relative;
  width: 100%;
  height: 100%;
}

.ew-gsap-section .slide-content img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  z-index: 1;
  position: relative;
}

.ew-gsap-section .slide-content .title {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-weight: 900;
  text-transform: uppercase;
  font-size: clamp(2rem, 5vw, 5rem);
  text-align: center;
  text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
  z-index: 2;
  pointer-events: none;
}

  /* Gradient backgrounds per slide index (only shown if no image is set) */
  .gradient-1 { background: linear-gradient(135deg, #2ecc71, #27ae60); }
  .gradient-2 { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
  .gradient-3 { background: linear-gradient(135deg, #3498db, #2980b9); }
  .gradient-4 { background: linear-gradient(135deg, #f39c12, #e67e22); }
  .gradient-5 { background: linear-gradient(135deg, #34495e, #2c3e50); }
  .gradient-6 { background: linear-gradient(135deg, #e74c3c, #c0392b); }
</style>


<div class="ew-gsap-section">
  <div class="panel"></div>
  <div class="wrapper center">
<div class="slider">
  {% for i in (1..6) %}
    {% capture img_key %}slide_{{ i }}_img{% endcapture %}
    {% capture text_key %}slide_{{ i }}_text{% endcapture %}
    {% assign image_obj = section.settings[img_key] %}
    {% assign text = section.settings[text_key] %}

    <div class="slide {% unless image_obj %}gradient-{{ i }}{% endunless %}">
      <div class="slide-content">
        {% if image_obj %}
          {{ image_obj | image_url: width: 800 | image_tag:
            class: '',
            alt: text,
            width: image_obj.width,
            height: image_obj.height,
            sizes: '(min-width: 768px) 420px, 100vw',
            widths: '300, 420, 600, 800'
          }}
        {% endif %}
        <div class="title">{{ text | truncate: 25, '' }}</div>
      </div>
    </div>
  {% endfor %}
</div>



  </div>
  <div class="panel"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
      console.warn('GSAP or ScrollTrigger not loaded.');
      return;
    }

    gsap.registerPlugin(ScrollTrigger);

    const slides = gsap.utils.toArray('.ew-gsap-section .slide');
    const delay = 0.5;

    const tl = gsap.timeline({
      defaults: {
        ease: 'power1.inOut',
        transformOrigin: 'center center -150px',
      },
      scrollTrigger: {
        trigger: '.ew-gsap-section .wrapper',
        pin: true,
        scrub: true,
      },
    });

    gsap.set(slides, {
      rotationX: (i) => (i ? -90 : 0),
      transformOrigin: 'center center -150px',
    });

    slides.forEach((slide, i) => {
      const nextSlide = slides[i + 1];
      if (!nextSlide) return;
      tl.to(
        slide,
        {
          rotationX: 90,
          onComplete: () => gsap.set(slide, { rotationX: -90 }),
        },
        '+=' + delay
      ).to(
        nextSlide,
        {
          rotationX: 0,
        },
        '<'
      );
    });

    tl.to({}, { duration: delay });
  });
</script>
